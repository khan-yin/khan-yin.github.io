---
title: 信号量机制经典例子
date: 2020-11-06 00:27:36
tags: 操作系统
---

## 理发师问题
7.8 The Sleeping-Barber Problem. A barbershop consists of a waiting room with n chairs and the barber room containing the barber chair. If there are no customers to be served,the barber goes to sleep. If a customer enters the barbershop and all chairs are occupied, then the customer leaves the shop.If the barber is busy but chairs are available, then the customer sits in one of the free chairs. If the barber is asleep, the customer wakes up the barber. Write a program to coordinate the barber and the customers.
<!--more-->
```c++
semaphore:
    full:=0,empty:=n,mutex:=1;//刘军的写法
/*
*full表示当前需要理发的人数
*empty表示当前还剩下多少空椅子
*mutex进程互斥控制量，理发师一次只能给一个人理发
*/
Parbegin:
    customer: repeat
            if empty=0:
                customer leaves the shop//没有空位置则离开
            P(empty);
            P(mutex);
            add a customer to chair
            V(mutex);
            V(full);
            until false;
    
    barber: repeat
            if full=0:
                barber sleep;//没有人需要理发则睡觉
            P(full);
            P(mutex);
            cutting hair
            V(mutex);
            V(empty);
            until false;
Parend;
```

## 生产者消费者
```c++
type item=...;
var buffer=...;

full,empty,mutex:semaphore;
nextp,nextc:item;
begin:
    full:=0;empty:=n;mutex:=1;
Parbegin:
    producer:repeat
        ...
        produce an item in nextp;
        ...
        p(empty);
        p(mutex);
        add nextp to buffer;
        V(mutex);
        V(full);
        until false;
    
    consumer:repeat
        ...
        p(full);
        p(mutex);
        remove an item from buffer to nextc;
        释放缓冲区
        V(mutex);
        P(empty);
        ...
        consume the item in nextc;
        ...
        until false;
Parend
```

## 读者写者
```c++
semaphore mutex:=1,wrt:=1;
int readcount:=0;
Parbegin:
    Writer:repeat
        P(wrt);
        写数据
        V(wrt);
    
    Reader:repeat
        P(mutex);
        readcount:=readcount+1;
        if readcount:=1 then P(wrt);
        V(mutex);
        读数据
        P(mutex);
        readcount:=readcount-1;
        if readcount=0 then V(wrt);
        V(mutex);
Parend
```

## 哲学家问题
```c++
semaphore chopstick[5];//初始信号量都为1
第i个进程描述为(i=0,… ,4)
   repeat
	  P(chopstick[i]);
	  P(chopstick[(i+1) mod 5]);
	  吃
	  V(chopstick[i]);
	  V(Chopstick[(i+1) mod 5];
	  思考
   until false;
```